<!DOCTYPE html>
<html lang="hu">
<head>
    <!--
    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damareen - Dashboard</title>
    <link rel="icon" type="image/x-icon" href="src/favicon.ico">
    <link rel="shortcut icon" href="src/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Jaro:opsz@6..72&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Jaro', sans-serif;
            background-color: #1A1A1D;
            color: #D9D9D9;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .top-controls {
            position: fixed;
            top: 25px;
            left: 25px;
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .control-btn {
            width: 55px;
            height: 55px;
            background: #C49B3B;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.28s;
            box-shadow: 0 4px 15px rgba(196, 155, 59, 0.4);
            font-size: 2rem;
            color: #1A1A1D;
            font-weight: bold;
        }

        .control-btn:hover {
            background: #d4ab4f;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 155, 59, 0.6);
        }

        .control-btn:active {
            transform: translateY(0px);
        }

        .pause-btn {
            position: fixed;
            top: 25px;
            right: 25px;
            width: 55px;
            height: 55px;
            background: #C49B3B;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.28s;
            box-shadow: 0 4px 15px rgba(196, 155, 59, 0.4);
            z-index: 100;
        }

        .pause-btn:hover {
            background: #d4ab4f;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 155, 59, 0.6);
        }

        .pause-icon {
            width: 24px;
            height: 24px;
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .pause-icon::before,
        .pause-icon::after {
            content: '';
            width: 6px;
            height: 24px;
            background: #1A1A1D;
            border-radius: 2px;
        }
        #user-display {
            position: fixed;
            top: 25px;
            right: 95px;
            height: 55px;
            font-family: 'Jaro', sans-serif;
            font-size: 2rem;
            font-weight: bold;
            color: #C49B3B;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 12px rgba(196, 155, 59, 0.4);
            z-index: 100;
        }

        #dashboard-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 100px 20px 120px;
        }

        h1 {
            font-family: 'Jaro', sans-serif;
            font-size: 4rem;
            font-weight: bold;
            color: #C49B3B;
            margin-bottom: 60px;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(196, 155, 59, 0.5);
            text-align: center;
        }

        .worlds-container {
            width: 100%;
            max-width: 1000px;
            margin-bottom: 50px;
            position: relative;
        }

        .worlds-container::before,
        .worlds-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 40px;
            pointer-events: none;
            z-index: 10;
        }

        .worlds-container::before {
            left: 0;
            background: linear-gradient(to right, #1A1A1D, transparent);
        }

        .worlds-container::after {
            right: 0;
            background: linear-gradient(to left, #1A1A1D, transparent);
        }

        .worlds-scroll {
            display: flex;
            gap: 25px;
            overflow-x: auto;
            padding: 20px 10px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            justify-content: center;
        }

        .worlds-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .worlds-scroll::-webkit-scrollbar-track {
            background: rgba(196, 155, 59, 0.1);
            border-radius: 10px;
            margin: 0 20px;
        }

        .worlds-scroll::-webkit-scrollbar-thumb {
            background: rgba(196, 155, 59, 0.5);
            border-radius: 10px;
        }

        .worlds-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(196, 155, 59, 0.7);
        }

        .world-card {
            min-width: 140px;
            width: 140px;
            height: 140px;
            background: #C49B3B;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(196, 155, 59, 0.3);
            position: relative;
        }

        .world-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 25px rgba(196, 155, 59, 0.5);
            background: #d4ab4f;
        }

        .world-card:active {
            transform: translateY(-2px) scale(1.02);
        }

        .world-name {
            font-family: 'Jaro', sans-serif;
            font-size: 1.4rem;
            font-weight: bold;
            color: #1A1A1D;
            text-align: center;
            letter-spacing: 1px;
        }

        .empty-worlds-message {
            font-family: 'Jaro', sans-serif;
            font-size: 1.5rem;
            color: #727272;
            text-align: center;
            padding: 40px 20px;
            width: 100%;
        }

        .start-button {
            padding: 15px 80px;
            background: transparent;
            border: 3px solid #C49B3B;
            border-radius: 8px;
            color: #C49B3B;
            font-family: 'Jaro', sans-serif;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(196, 155, 59, 0.2);
            letter-spacing: 2px;
            margin-top: 20px;
        }

        .start-button:hover {
            background: #C49B3B;
            color: #1A1A1D;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(196, 155, 59, 0.4);
        }

        .start-button:active {
            transform: translateY(-1px);
        }

        #message {
            margin-top: 30px;
            font-weight: bold;
            min-height: 22px;
            color: #C49B3B;
            text-align: center;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 3rem;
                margin-bottom: 40px;
            }

            .world-card {
                min-width: 120px;
                width: 120px;
                height: 120px;
            }

            .world-name {
                font-size: 1.2rem;
            }

            .start-button {
                padding: 12px 60px;
                font-size: 1.5rem;
            }

            .control-btn,
            .pause-btn {
                width: 45px;
                height: 45px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="top-controls">
        <button class="control-btn" id="add-world-btn" title="Világ hozzáadása">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
            </svg>
        </button>
        <button class="control-btn" id="logout-btn" title="Kijelentkezés">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
                <path d="M17 16L21 12M21 12L17 8M21 12L7 12M13 16V17C13 18.6569 11.6569 20 10 20H6C4.34315 20 3 18.6569 3 17V7C3 5.34315 4.34315 4 6 4H10C11.6569 4 13 5.34315 13 7V8" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
            </svg>
        </button>
    </div>

    <button class="pause-btn" id="settings-btn" title="Beállítások">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="none" aria-hidden="true" focusable="false">
            <path d="M262.29,192.31a64,64,0,1,0,57.4,57.4A64.13,64.13,0,0,0,262.29,192.31ZM416.39,256a154.34,154.34,0,0,1-1.53,20.79l45.21,35.46A10.81,10.81,0,0,1,462.52,326l-42.77,74a10.81,10.81,0,0,1-13.14,4.59l-44.9-18.08a16.11,16.11,0,0,0-15.17,1.75A164.48,164.48,0,0,1,325,400.8a15.94,15.94,0,0,0-8.82,12.14l-6.73,47.89A11.08,11.08,0,0,1,298.77,470H213.23a11.11,11.11,0,0,1-10.69-8.87l-6.72-47.82a16.07,16.07,0,0,0-9-12.22,155.3,155.3,0,0,1-21.46-12.57,16,16,0,0,0-15.11-1.71l-44.89,18.07a10.81,10.81,0,0,1-13.14-4.58l-42.77-74a10.8,10.8,0,0,1,2.45-13.75l38.21-30a16.05,16.05,0,0,0,6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16,16,0,0,0-6.07-13.94l-38.19-30A10.81,10.81,0,0,1,49.48,186l42.77-74a10.81,10.81,0,0,1,13.14-4.59l44.9,18.08a16.11,16.11,0,0,0,15.17-1.75A164.48,164.48,0,0,1,187,111.2a15.94,15.94,0,0,0,8.82-12.14l6.73-47.89A11.08,11.08,0,0,1,213.23,42h85.54a11.11,11.11,0,0,1,10.69,8.87l6.72,47.82a16.07,16.07,0,0,0,9,12.22,155.3,155.3,0,0,1,21.46,12.57,16,16,0,0,0,15.11,1.71l44.89-18.07a10.81,10.81,0,0,1,13.14,4.58l42.77,74a10.8,10.8,0,0,1-2.45,13.75l-38.21,30a16.05,16.05,0,0,0-6.05,14.08C416.17,247.67,416.39,251.83,416.39,256Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" fill="none"/>
        </svg>
    </button>
    <div id="user-display"></div>

    <div id="dashboard-container">
        <h1>Válassz világot</h1>

        <div class="worlds-container">
            <div class="worlds-scroll" id="worlds-scroll">
                <!-- Worlds will be loaded dynamically -->
            </div>
        </div>

        <button class="start-button" id="start-btn">Start</button>

        <p id="message"></p>
    </div>

    <script>
        const API_URL = 'https://damareen.deakteri.fun/api';
        const messageElement = document.getElementById('message');
        const worldsScroll = document.getElementById('worlds-scroll');
        
        let selectedWorldId = null;

        worldsScroll.addEventListener('wheel', (e) => {
            if (e.deltaY !== 0) {
                e.preventDefault();
                worldsScroll.scrollLeft += e.deltaY;
            }
        });
        
        async function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (!token || !user) {
                window.location.href = 'auth.html';
                return;
            }
            
            try {
                const userData = JSON.parse(user);
                console.log('Logged in as:', userData.username);
                const username = userData.username || userData.name || 'Ismeretlen';
                const userDisplay = document.getElementById('user-display');
                if (userDisplay) userDisplay.textContent = `Üdv, ${username}!`;
            } catch (error) {
                console.error('Error parsing user data:', error);
                const userDisplay = document.getElementById('user-display');
                if (userDisplay) userDisplay.textContent = 'Hiba';
            }
        }

        async function loadWorlds() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/user/list/worlds`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch worlds');
                }

                const data = await response.json();
                
                if (data.success) {
                    const worlds = data.data.worlds;
                    const whereUserIsMaster = data.data.where_user_is_master || [];
                    
                    renderWorlds(worlds, whereUserIsMaster);
                } else {
                    messageElement.textContent = 'Hiba a világok betöltésekor';
                    messageElement.style.color = '#ff6b6b';
                }
            } catch (error) {
                console.error('Error loading worlds:', error);
                messageElement.textContent = 'Hiba a világok betöltésekor';
                messageElement.style.color = '#ff6b6b';
            }
        }

        function renderWorlds(worlds, whereUserIsMaster) {
            worldsScroll.innerHTML = '';
            
            
            if (!worlds || Object.keys(worlds).length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'empty-worlds-message';
                emptyMessage.textContent = 'Még nincs létrehozva világ';
                worldsScroll.appendChild(emptyMessage);
                return;
            }

            
            for (const [worldId, worldName] of Object.entries(worlds)) {
                const card = document.createElement('div');
                card.className = 'world-card';
                card.dataset.worldId = worldId;
                
                const isMaster = whereUserIsMaster.includes(worldId);
                if (isMaster) {
                    card.style.background = '#72a6ac';
                    card.style.boxShadow = '0 4px 15px rgba(114, 166, 172, 0.3)';
                    card.dataset.isMaster = 'true';
                }
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'world-name';
                nameDiv.textContent = worldName;
                
                card.appendChild(nameDiv);
                worldsScroll.appendChild(card);
                
                card.addEventListener('mouseenter', () => {
                    if (isMaster) {
                        card.style.boxShadow = '0 8px 25px rgba(114, 166, 172, 0.8)';
                    }
                });
                
                card.addEventListener('mouseleave', () => {
                    if (isMaster && selectedWorldId !== worldId) {
                        card.style.boxShadow = '0 4px 15px rgba(114, 166, 172, 0.3)';
                    } else if (isMaster && selectedWorldId === worldId) {
                        card.style.boxShadow = '0 4px 15px rgba(114, 166, 172, 0.6)';
                    }
                });
                
                card.addEventListener('click', () => {
                    if (selectedWorldId === worldId) {
                        card.style.outline = 'none';
                        card.style.boxShadow = isMaster ? '0 8px 25px rgba(114, 166, 172, 0.8)' : '0 8px 25px rgba(196, 155, 59, 0.5)';
                        selectedWorldId = null;
                        messageElement.textContent = '';
                    } else {
                        document.querySelectorAll('.world-card').forEach(c => {
                            c.style.outline = 'none';
                            if (c.dataset.isMaster === 'true') {
                                c.style.boxShadow = '0 4px 15px rgba(114, 166, 172, 0.3)';
                            } else {
                                c.style.boxShadow = '';
                            }
                        });
                        
                        const outlineColor = isMaster ? '#72a6ac' : '#C49B3B';
                        card.style.outline = `3px solid ${outlineColor}`;
                        card.style.outlineOffset = '5px';
                        card.style.boxShadow = isMaster ? '0 4px 15px rgba(114, 166, 172, 0.6)' : '0 4px 15px rgba(196, 155, 59, 0.3)';
                        selectedWorldId = worldId;
                        
                        messageElement.textContent = `Kiválasztva: ${worldName}`;
                        messageElement.style.color = '#C49B3B';
                    }
                });
            }
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            if (!selectedWorldId) {
                messageElement.textContent = 'Kérlek válassz egy világot!';
                messageElement.style.color = '#ff6b6b';
                return;
            }
            
            messageElement.textContent = 'Indítás...';
            messageElement.style.color = '#C49B3B';
            
            setTimeout(() => {
                console.log('Starting world:', selectedWorldId);
                messageElement.textContent = 'Világ betöltve!';
            }, 1000);
        });

        document.getElementById('add-world-btn').addEventListener('click', () => {
            window.location.href = 'manage_world.html';
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'auth.html';
        });

        document.getElementById('settings-btn').addEventListener('click', () => {
            messageElement.textContent = 'Beállítások megnyitása...';
            messageElement.style.color = '#C49B3B';
        });

        checkAuth();
        loadWorlds();
    </script>
</body>
</html>
